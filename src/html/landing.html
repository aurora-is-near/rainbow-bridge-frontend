<div class="landing" data-behavior="landing">
  <h1 class="logo--landing-page">
    <img class="rainbow-icon" src="/img/rainbow-bridge.svg" />
    <small>
      ETH
      <img
        alt="to and from"
        src="img/swap-lr.svg"
        style="display: inline; vertical-align: bottom"
      />
      NEAR
    </small>
    <div class="logo-text--primary">
      Rainbow <br />
      Bridge
      <span class="beta-tag">Beta</span>
    </div>
  </h1>
  <div class="content-wrapper">
    <p class="landing-blurb">
      Transfer tokens between Ethereum and NEAR! Connect a NEAR and Ethereum
      account to get started.
    </p>
    <form method="get" class="panel">
      <include src="authenticated-accounts.html"></include>
      <div class="cta-container">
        <button data-behavior="landingSubmit" class="full-width">
          Begin new transfer
        </button>
        <button
          type="button"
          class="link button--missing-transfer"
          data-behavior="newRecovery"
        >
          Restore transfer
        </button>
      </div>
    </form>
    <p class="create-account">
      Need a NEAR account? Create one
      <a
        data-behavior="openClaimModal"
        style="cursor: pointer"
      >here</a>.
    </p>
    <div data-behavior="claimVerification" class="modal" style="display: none">
      <div class="modal__container">
        <nav class="modal__nav">
          <button
            type="button"
            class="modal__nav__button--close"
            data-behavior="closeModal"
          >
            <span class="visually-hidden">close</span>
          </button>
        </nav>
        <div data-behavior="enoughETH">
          <div class="modal-image__container">
            <img src="img/gift.svg" alt="" class="modal__image"/>
          </div>
          <h1 class="modal__heading">Claim Your NEAR Account</h1>
          <p class="modal__message">
            Ethereum holders may create a NEAR account using the
            <a target="_blank" rel="noopener noreferrer" href="https://faucet.paras.id/">Paras Faucet</a>.
            Connect your Ethereum wallet to get started.
          </p>
        </div>
        <div data-behavior="notEnoughETH" style="display: none">
          <div class="modal-image__container">
            <img src="img/empty-wallet.svg" alt="" class="modal__image"/>
          </div>
          <h1 class="modal__heading">Insufficient funds to claim account</h1>
          <p class="modal__message">
            Your Ethereum wallet must have a balance of at least 0.05 ETH as proof of liquidity in order to claim your account.
          </p>
        </div>
        <div class="authenticated-account__details space_around">
          <img src="img/ethereum.svg" alt="" class="network-indicator network--ethereum"/>
          <div data-behavior="ethAccountPlaceholder">Ethereum</div>
          <button
            type="button"
            class="button-size--small"
            id="authEthereum"
            data-behavior="authEthereum"
          >
            Connect
          </button>
          <button
            class="button-size--small button-variant--secondary"
            data-behavior="disconnectEthereum"
            style="display: none"
            type="button"
          >
            Disconnect
          </button>
        </div>
        <button data-behavior="verifyEthAddress" class="full-width">
          Verify & Continue
        </button>
      </div>
    </div>
    <div data-behavior="claimSignature" class="modal" style="display: none">
      <include src="sign-message-modal.html"></include>
    </div>
    <div data-behavior="claimReady" class="modal" style="display: none">
      <include src="claim-ready-modal.html"></include>
    </div>
    <div data-behavior="claimError" class="modal" style="display: none">
      <div class="modal__container">
        <nav class="modal__nav">
          <button
            type="button"
            class="modal__nav__button--close"
            data-behavior="closeModal"
          >
            <span class="visually-hidden">close</span>
          </button>
        </nav>
        <div class="modal-image__container">
          <img src="img/warning.svg" alt="" class="modal__image" />
        </div>
        <h1 class="modal__heading">Oops! Something went wrong</h1>
        <p class="modal__message" data-behavior="claimErrorMessage"></p>
        <button data-behavior="openClaimModal" class="full-width">
          Return
        </button>
      </div>
    </div>
  </div>
</div>
<style>
  .landing {
    margin-bottom: 140px;
  }

  .landing-blurb {
    margin-top: var(--spacing-xxl);
    padding: 0 var(--spacing-xl);
  }

  .panel {
    background-color: var(--white);
    border-radius: 1em;
    box-shadow: 0px 51px 121px rgba(0, 0, 0, 0.05),
      0px 21.3066px 50.5509px rgba(0, 0, 0, 0.0359427),
      0px 11.3915px 27.0269px rgba(0, 0, 0, 0.0298054),
      0px 6.38599px 15.1511px rgba(0, 0, 0, 0.025),
      0px 3.39155px 8.04662px rgba(0, 0, 0, 0.0201946),
      0px 1.4113px 3.34838px rgba(0, 0, 0, 0.0140573);
    margin: 80px var(--spacing-m);
    margin-bottom: var(--spacing-l);
    padding: var(--spacing-m);
  }
  .create-account {
    font-size: var(--fs-small);
    border: 1px solid var(--gray-300);
    border-radius: var(--br-base);
    padding: var(--spacing-m);
    margin: 0 var(--spacing-m);
  }
  @media (min-width: 928px) {
    .landing {
      background: url(img/landing-bg-left.svg) no-repeat,
        url(img/landing-bg-right.svg) no-repeat;
      background-position: top 22em left calc(50% - 22em),
        top 31em right calc(50% - 21em);
    }

    .panel {
      margin: 80px auto;
      margin-bottom: var(--spacing-l);
    }
    .create-account {
      margin: 0;
    }
  }
  .cta-container {
    margin-top: var(--spacing-xxl);
  }
  .cta-container .button--missing-transfer {
    font-size: var(--fs-body);
    font-weight: var(--fw-regular);
    margin-top: 0.5em;
  }
  .space_around {
    margin: var(--spacing-xxl) 0;
  }
</style>
<script>
  window.addEventListener("load", function addLoginParasFaucetHandler () {
    const verifyButton = window.dom.find("verifyEthAddress");
    const claimButton = window.dom.find("claimNEARAccount");
    window.dom.onClick('openClaimModal', function renderClaimModal () {
      if (process.env.ethNetworkId !== 'main') {
        window.location.href = 'https://wallet.testnet.near.org/'
        return
      }
      window.dom.hide("claimError")
      window.dom.show("enoughETH")
      window.dom.hide("notEnoughETH")
      verifyButton.disabled = false
      if (!window.ethInitialized) {
        verifyButton.disabled = true
      }
      window.dom.show("claimVerification")
    })

    verifyButton.onclick = async () => {
      try{
        await window.faucetUtils.checkETHBalance()
      } catch(error) {
        console.error(error.message)
        window.dom.hide("enoughETH")
        window.dom.show("notEnoughETH")
        verifyButton.disabled = true
        return
      }
      window.dom.hide("claimVerification")
      window.dom.show("claimSignature")
      try{
        await window.faucetUtils.parasFaucetLogin()
      } catch(error) {
        console.log(error.message)
        window.dom.fill('claimErrorMessage').with(error.message);
        window.dom.hide("claimSignature")
        window.dom.show("claimError")
        return
      }
      window.dom.hide("claimSignature")
      window.dom.show("claimReady")
    }

    claimButton.onclick = async () => {
      window.dom.fill('claimErrorMessage').with("");
      let claimURL
      try {
        claimURL = await window.faucetUtils.getClaimURL()
      } catch(error) {
        console.error(error.message)
        window.dom.fill('claimErrorMessage').with(error.message);
        window.dom.hide("claimReady")
        window.dom.show("claimError")
        return
      }
      window.location.href = claimURL
    }
  })

  async function renderLanding () {
    if (window.ethInitialized) {window.dom.find("verifyEthAddress").disabled = false}
    if (window.ethInitialized && window.nearInitialized) {
      window.dom.find("landingSubmit").disabled = false;
    } else {
      // window.dom.show("landing");
      window.dom.find("landingSubmit").disabled = true;
      return;
    }

    const transfers = await window.transfers.get();
    const params = Object.keys(window.urlParams.get());

    if (transfers.length || params.length) {
      window.dom.hide("landing");
    } else {
      window.dom.show("landing");
    }
  }

  window.renderers.push(renderLanding);
</script>
